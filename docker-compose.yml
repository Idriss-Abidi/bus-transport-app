version: "3.9"

networks:
  app-net:
    driver: bridge

services:
  trajet-service:
    build:
      context: ./trajet-service
      dockerfile: Dockerfile
    image: trajet-service:latest
    container_name: trajet-service
    ports:
      - "4000:4000"
    environment:
      # Leave empty to use H2 from application.properties; override for Postgres when needed
      # SPRING_DATASOURCE_URL: jdbc:postgresql://trajet-service-db:5432/db
      # SPRING_DATASOURCE_DRIVER_CLASS_NAME: org.postgresql.Driver
      # SPRING_DATASOURCE_USERNAME: user
      # SPRING_DATASOURCE_PASSWORD: pass
      # SPRING_PROFILES_ACTIVE: docker
      TZ: "UTC"
    networks:
      - app-net

  ticket-service:
    build:
      context: ./ticket-service
      dockerfile: Dockerfile
    image: ticket-service:latest
    container_name: ticket-service
    depends_on:
      - trajet-service
    ports:
      - "4003:4003"
    environment:
      # If you later switch to configurable base URLs, you can set:
      # TRAJET_SERVICE_BASE_URL: http://trajet-service:4000
      TZ: "UTC"
    networks:
      - app-net

  api-gateway:
    build:
      context: ./api-gateway
    image: api-gateway:latest
    container_name: api-gateway
    depends_on:
      - trajet-service
      - ticket-service
    ports:
      - "4004:4004"
    environment:
      # Using in-network DNS hostnames configured in application.yml (trajet-service, ticket-service)
      # To override locally, set these:
      # TRAJET_SERVICE_URL: http://trajet-service:4000
      # TICKET_SERVICE_URL: http://ticket-service:4003
      TZ: "UTC"
    networks:
      - app-net
